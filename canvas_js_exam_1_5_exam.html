<!DOCTYPE html>
<html lang="en">  <!-- ê¸°ë³¸ì–¸ì–´ : ì˜ì–´ -->
<head>
  <meta charset="UTF-8" /> <!-- í˜ì´ì§€ ì–¸ì–´ ì¸ì½”ë”© í˜•ì‹ -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/> <!-- í™”ë©´í¬ê¸°ì— ë”°ë¼ ë³´ì—¬ì§€ëŠ” í¬ê¸° ë§ì¶”ê¸° -->
  <title>Web Animation(canvas_js_css)[1ë‹¨ì›-5]</title>
  <style>
    /* í˜ì´ì§€ ì „ì²´ ì„¤ì • */
    body {
      margin: 0;
      padding: 0;
      text-align: center;
      font-family: sans-serif;
    }
    /* ì• ë‹ˆë©”ì´ì…˜ í™”ë©´ ì„¤ì • */
    #canvas {
      background: #DCD7C9;
      display: block;
      margin: 0 auto;
    }

    /* 1_5 : PC ì•ˆë‚´ ë¬¸êµ¬ ê¸°ë³¸ì€ ìˆ¨ê¹€ */
    .pc-guide {
      display: none; /* 1_5 : í™”ë©´ì— ë³´ì´ì§€ ì•Šê²Œí•¨ */
      margin-top: 10px; /* 1_5 : ìœ„ìª½ì—¬ë°± */
      font-size: 16px; /* 1_5 : ë²„íŠ¼ ê¸€ìí¬ê¸° */
      color: #333; /* 1_5 : ê¸€ììƒ‰ */
      font-weight: bold; /* 1_5 : ê¸€ìêµµê²Œ */
    }

    /* PCì—ì„œëŠ” 600x600 ê³ ì • */
    @media (min-width: 769px) {
      #canvas {
      width: 600px;
      height: 600px;
      }

      .pc-guide {
        display: block; /* 1_5 : pc-guideë¥¼ PCì—ì„œ ì ‘ì†ì‹œ ë³´ì´ê²Œí•¨ */
      }
    }

    /* 1_5 : ë²„íŠ¼ì„ ê°ì‹¸ëŠ” div ìˆ¨ê¸°ê¸° (PCì—ì„œëŠ” ì•ˆ ë³´ì´ê²Œí•˜ê³  ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ì ‘ì†ì´ ë³´ì„) */
    .controls {
      display: none; /* 1_5 : í™”ë©´ì— ë³´ì´ì§€ ì•Šê²Œí•¨ */
      margin-top: 10px; /* 1_5 : ìœ„ìª½ ì¦‰ ê° ë²„ìŠ¤í•˜ê³  ì—¬ë°±ì„ 10í”½ì…€ì¤Œ */
    }

    /* 1_5 : ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ë³´ì—¬ì§ˆ ë²„íŠ¼ ëª¨ì–‘ ì„¤ì • */
    .controls button {
      font-size: 18px; /* 1_5 : ë²„íŠ¼ ê¸€ìí¬ê¸° */
      padding: 10px 20px; /* 1_5 : ì•ˆìª½ì—¬ë°± : ìœ„ì•„ë˜ì—¬ë°± ì¢Œìš°ì—¬ë°± */
      margin: 5px; /* 1_5 : ë²„íŠ¼ ë°”ê¹¥ìª½ ì—¬ë°±ì„ 5í”½ì…€ì¤Œ */
    }

    /* 1_5 : í™”ë©´ì´ ì‘ì„ ë•Œ (ìŠ¤ë§ˆíŠ¸í° ë“±ì—ì„œ ë³´ì¸ë‹¤ë©´ ì•„ë˜ ì½”ë“œë™ì‘)
       í™”ë©´ì˜ í­ì´ ìµœëŒ€ 768í”½ì…€ë³´ë‹¤ ì´í•˜ì´ë©´ ì•„ë˜ cssë™ì‘í•¨ ì•„ë‹ˆë©´ ìœ„ PCìš© CSS @media (min-width: 769px) ë™ì‘í•¨
       ìµœê·¼ ìŠ¤ë§ˆíŠ¸í°ì˜ í•´ìƒë„ëŠ” PCë³´ë‹¤ë„ ì¢‹ì€ ê²½ìš°ê°€ ë§ì€ë° 768í”½ì…€ë³´ë‹¤ ì‘ìœ¼ë©´ ìŠ¤ë§ˆíŠ¸í°ì´ë¼ë‹ˆ?
        ì´ìœ  : ìŠ¤ë§ˆíŠ¸í°ì˜ ë¬¼ë¦¬ì ì¸ í•´ìƒë„ëŠ” ë” í¬ì§€ë§Œ, í™”ë©´ì„ ì‘ê²Œ ë³´ì´ë„ë¡ í•˜ê¸° ìœ„í•´ **ë””ë°”ì´ìŠ¤ í”½ì…€ ë¹„ìœ¨(DPR, divicePixelRatio)**ì„ ì‚¬ìš©í•¨
       ì•„ì´í°13ì˜ ê°€ë¡œí•´ìƒë„ê°€ 1170í”½ì…€ì¸ë° CSSí”½ì…€ë¡œëŠ” 1170/3=390í”½ì…€ì„
       í˜„ì¬ ê¸°ê¸°ë¡œ ë³´ì•„ë„ 768 CSSí”½ì…€ì´ë©´ ëª¨ë“  ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ì ‘ì†í•˜ëŠ” ê²ƒìœ¼ë¡œ íŒë‹¨í•¨ */

    @media (max-width: 768px) {
      #canvas {
        width: 100vw; /* 1_5 : ìŠ¤ë§ˆíŠ¸í° í™”ë©´ canvas ê°€ë¡œ ì „ì²´ í¬ê¸°ë¡œí•¨ */
        height: 100vw; /* 1_5 : í™”ë©´ canvas ì„¸ë¡œ = ê°€ë¡œ (ì •ì‚¬ê°í˜•) */
      }
      .controls {
        display: block; /* 1_5 : ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ì ‘ì†ì‹œ controlsì„ ë³´ì´ê²Œí•¨ */
      }
      .pc-guide {
        display: none; /* 1_5 : pc-guideë¥¼ ìŠ¤ë§ˆíŠ¸í° ì ‘ì†ì‹œ ìˆ¨ê¹€ */
      }
    }

    /* === OverLay_UI === */
    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }

    .overlay-content {
      background: white;
      padding: 30px;
      border-radius: 10px;
      text-align: center;
      min-width: 250px;
    }

    .overlay-content h2 { margin-bottom: 20px;}
    .overlay-content button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }

  </style>
</head>
<body>
  <!-- ì• ë‹ˆë©”ì‹œì—° í™”ë©´ ë§Œë“¤ê¸° -->
  <canvas id="canvas"></canvas>

  <!-- 1_5 : ì• ë‹ˆë©”ì´ì…˜ í™”ë©´ ë§Œë“¤ê¸° : ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ì ‘ì† í•  ë•Œë§Œ controlsì´ ë³´ì´ê²Œë¨ -->
  <div class="controls">
    <button id="leftBtn">â—€</button>
    <button id="rightBtn">â–¶</button>
    <button id="upBtn">â–²</button>
    <button id="downBtn">â–¼</button>
  </div>

  <!-- 1_5 : PC ì „ìš© ì•ˆë‚´ ë¬¸êµ¬ -->
  <div class="pc-guide">
    PCì—ì„œ ì ‘ì†í–ˆìŠµë‹ˆë‹¤. ë°©í–¥í‚¤ë¡œ ì´ë™í•˜ì„¸ìš”.<br>
    ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ì ‘ì† ì‹œ ë³´ì´ëŠ” ë²„íŠ¼ìœ¼ë¡œ ì´ë™í•˜ì„¸ìš”.
  </div>

  <!-- OverLay_UI -->
   <div class="overlay" id="overlay">
    <div class="overlay-content">
      <h2 id="overlayTitle">Game Over</h2>
      <p id="overlayMessage"></p>
      <button id="restartBtn">ì¬ì‹œì‘</button>
    </div>
   </div>

  <script>
    // ìº”ë²„ìŠ¤ ìš”ì†Œ J5 ë³€ìˆ˜ë§Œë“¤ê¸°
    const drawingBoard = document.getElementById('canvas');
    // ìº”ë²„ìŠ¤ì— 2Dê·¸ë¦¼ì„ ê·¸ë¦¬ëŠ” ë„êµ¬ ë³€ìˆ˜ë§Œë“¤ê¸°
    const drawingPen = drawingBoard.getContext('2d');

    // ìº”ë²„ìŠ¤ í¬ê¸°ë¥¼ CSSì™€ ë§ì¶°ì¤Œ (ì¤‘ìš”!)
    // ì•„ë˜ì²˜ëŸ¼ í•˜ë©´ PCëŠ” 600x600ìœ¼ë¡œ ì„¤ì •ë˜ê³  ìŠ¤ë§ˆíŠ¸í°ì€ 360x360ìœ¼ë¡œ í™”ë©´ê³„ì‚°ëœ ë‚˜ì¤‘ì— í•„ìš”í•˜ë©´ ì°¸ê³ ì‚¬ìš©
    // drawingBoard.width = drawingBoard.clientWidth;
    // drawingBoard.height = drawingBoard.clientHeight;
    // ìº”ë²„ìŠ¤ ë‚´ë¶€ í•´ìƒë„ëŠ” ë¬´ì¡°ê±´ 600x600 ê³ ì •(PC, ìŠ¤ë§ˆíŠ¸í° ëª¨ë‘)
    drawingBoard.width = 600;
    drawingBoard.height = 600;

    // ì£¼ì¸ê³µ ìœ„ì¹˜(í™”ë©´ ì™¼ìª½ í•˜ë‹¨)
    let x = 20;
    let y = (drawingBoard.height - 30); //570

    //ì  ìœ„ì¹˜(í•˜ë©´ ê°€ìš´ë°)
    let ex = new Array(5);
    let ey = new Array(5);

    let enemyCnt=ex.length;

    for (let i = 0; i < ex.length; i++) {
      ex[i] = Math.round(Math.random() * (drawingBoard.width - 20));
      ey[i] = Math.round(Math.random() * (drawingBoard.height - 20));
    }

    let timerMinutes = 0;
    let timerSeconds = 0;
    let startTime = Date.now();
    let stopCountdown = null;

   function startCountdown(ms, onTick, onEnd) {
    const start=performance.now();
    const end=start+ms;
    let tId=0;

    function step() {
      const now = performance.now();
      const remaining = Math.max(0, end - now); //reaminingì— 0ê³¼ end-nowì¤‘ í° ê°’ì„ ë„£ëŠ”ë‹¤.(ìŒìˆ˜ê°€ ë³€ìˆ˜ì— ë“¤ì–´ê°€ëŠ” ê²½ìš°ë¥¼ ì—†ì—ì„œ ë³´ì •ì„ í•¨)
      const totalSeconds = Math.ceil(remaining / 1000);
      const minutes = Math.floor(totalSeconds / 60);
      const second = totalSeconds % 60;
      onTick?.(minutes, second);

      if (remaining === 0) {
        onEnd?.();
        return;
      }

      const nextDelay = Math.min(1000, Math.max(0, 1000 - (now % 1000)));
      tId = setTimeout(step, nextDelay);
    }

    step();
    return () => clearInterval(tId);
   }

    //ì£¼ì¸ê³µ í¬ê¸°
    const heroWidth = 10;
    const heroHeith = 10;

    //ì  í¬ê¸°
    const enemyWidth = 20;
    const enemyHeith = 20;

    // ì£¼ì¸ê³µ ì´ë™ì†ë„
    const moveAmount = 5;

    // ì£¼ì¸ê³µ ì´ë™í•¨ìˆ˜
    function moveRight() {x = x + moveAmount;}
    function moveLeft() {x = x - moveAmount;}
    function moveDown() {y = y + moveAmount;}
    function moveUp() {y = y - moveAmount;}

    // 1_4 : ì£¼ì¸ê³µ ì´ë™ì œí•œ
    function move_limit() {
      if(x<0) {//ì™¼ìª½ ì´ë™ì œí•œ
        x = 0;
      }
      if(x>=drawingBoard.width-10) {//ì˜¤ë¥¸ìª½ ì´ë™ì œí•œ
        x = (drawingBoard.width-10);
      }
      if(y<0) {//ìœ„ìª½ ì´ë™ì œí•œ
        y=0;
      }
      if(y>=drawingBoard.height-10) {//ì•„ë˜ìª½ ì´ë™ì œí•œ
        y=(drawingBoard.height-10);
      }
    }

    //1_4 : ìº”ë²„ìŠ¤ ì™¼ìª½ ìƒë‹¨ì— í…ìŠ¤íŠ¸ ì¶œë ¥í•¨ìˆ˜
    function drawCoordinate() {
      drawingPen.fillStyle = 'black';
      drawingPen.font = '10px sans-serf';
      drawingPen.fillText(`x: ${x} y: ${y}`, 10, 20);
    }

    // ì£¼ì¸ê³µ ì¶œë ¥í•¨ìˆ˜
    function drawHero() {
      drawingPen.fillStyle = 'black';
      drawingPen.fillRect(x, y, heroWidth, heroHeith);
    }

    // ì  ì¶œë ¥í•¨ìˆ˜
    function enemy1() {
      for (let i = 0; i < ex.length; i++) {
        drawingPen.fillStyle = 'red';
        drawingPen.fillRect(ex[i], ey[i], enemyWidth, enemyHeith);
      }
    }

    // ì  ì¶©ëŒí•¨ìˆ˜
    function collision1() {
      for (let i = 0; i < ex.length; i++) {
        if((x+heroWidth) > ex[i] && x < (ex[i]+enemyWidth) && (y+heroHeith) > ey[i] && y < (ey[i]+enemyHeith)) {
          ex[i] = Number.MAX_SAFE_INTEGER;
          ey[i] = Number.MAX_SAFE_INTEGER;
          enemyCnt--;
        }
      }
      
    }

    function counter() {
        drawingPen.fillStyle = 'black';
        drawingPen.font = '10px sans-serf';
        drawingPen.fillText(`RED no ${enemyCnt}`, 550, 20);
    }

    function drawTimer() {
      drawingPen.fillStyle = 'black';
      drawingPen.font = '10px sans-serf';
      drawingPen.fillText(`${timerMinutes}:${timerSeconds.toString().padStart(2, "0")} ì´ˆ`, (canvas.width/2), 20);
    }

    // === OverLay ê´€ë ¨ ===
    const overlay = document.getElementById("overlay");
    const overlayTitle = document.getElementById("overlayTitle");
    const overlayMessage = document.getElementById("overlayMessage");
    const restartBtn = document.getElementById("restartBtn");
    restartBtn.addEventListener("click", () => location.reload());

    function gameOverOverlay(type, value = "") {
      if (type === "over") {
        overlayTitle.textContent = "ê²Œì„ì˜¤ë²„";
        overlayMessage.textContent = "ì‹œê°„ì´ ë‹¤ ë˜ì—ˆìŠµë‹ˆë‹¤!";
      }else if (type === "record") {
        overlayTitle.textContent = "ğŸ‰ í´ë¦¬ì–´!";
        overlayMessage.textContent = `ê¸°ë¡: ${value}ì´ˆ`;
      }
      overlay.style.display = "flex";
    }

    let isGameOver = false;

    // í™”ë©´ì— ì¶œë ¥í•˜ê¸°
    function draw() {
      if (isGameOver) return; // ê²Œì„ ëë‚¬ìœ¼ë©´ draw ë£¨í”„ ì¤‘ë‹¨

      drawingPen.fillText(`x: ${x} y: ${y}`, 10, 20); //1_4 : ìº”ë²„ìŠ¤ ì™¼ìª½ ìƒë‹¨ì— í…ìŠ¤íŠ¸ ì¶œë ¥
      drawingPen.clearRect(0, 0, canvas.width, canvas.height);  //í™”ë©´ì§€ìš°ê¸°/      drawTimer();  // íƒ€ì´ë¨¸ì¶œë ¥í•¨ìˆ˜í˜¸ì¶œ
      drawHero(); // ì£¼ì¸ê³µì¶œë ¥í•¨ìˆ˜í˜¸ì¶œ
      enemy1(); // ì  ì¶œë ¥í•¨ìˆ˜ í˜¸ì¶œ
      collision1(); //ì  ì¶©ëŒí•¨ìˆ˜ í˜¸ì¶œ
      counter();  // ì  ì¹´ìš´íŠ¸í•¨ìˆ˜ í˜¸ì¶œ
      move_limit(); //1_4 : ì£¼ì¸ê³µ ì´ë™ ì œí•œ í•¨ìˆ˜í˜¸ì¶œ
      drawCoordinate(); //1_4 : í…ìŠ¤íŠ¸ ì¶œë ¥ í•¨ìˆ˜í˜¸ì¶œ
      drawTimer();  //íƒ€ì´ë¨¸ ì¶œë ¥í•¨ìˆ˜ í˜¸ì¶œ

      // ì¡°ê±´ ì²´í¬
      if (enemyCnt === 0) {
        let elapsed = ((Date.now() - startTime)/1000).toFixed(1);
        stopCountdown?.();
        isGameOver = true;
        gameOverOverlay("record", elapsed);
      }
    }

    stopCountdown = startCountdown(
      60_000,
      (m, s) => { timerMinutes = m; timerSeconds = s; },
      () => { 
        if (!isGameOver) {              // ì´ë¯¸ ê²Œì„ ëë‚¬ìœ¼ë©´ ë‹¤ì‹œ ì•ˆ ë„ì›€
          isGameOver = true;
          gameOverOverlay("over"); 
        }
      }
    );

    setInterval(draw, 16);  // 60FPS
    

    document.addEventListener('keydown', (e) => {
    
      switch (e.key) {
        case 'ArrowLeft': moveLeft(); break;
        case 'ArrowRight': moveRight(); break;
        case 'ArrowUp': moveUp(); break;
        case 'ArrowDown': moveDown(); break;
      }
    });

    // 1_5 : ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²° : ë²„íŠ¼ì„ ì„ íƒí•˜ë©´ í•´ë‹¹ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì„œ ì£¼ì¸ê³µ ì´ë™
    //   document : í˜„ì¬ ì›¹ í˜ì´ì§€ ì „ì²´ë¥¼ ì˜ë¯¸
    //   getElementById('leftBrn') : ì›¨ í˜ì´ì§€ì—ì„œ idê°€ leftBtnì¸ **ë²„íŠ¼**ì„ ì˜ë¯¸
    //   addEventListener : "ì–´ë–¤ ì¼ì´ ì¼ì–´ë‚¬ì„ ë•Œ" ì‹¤í–‰í•¨ ì½”ë“œë¥¼ ì§€ì •í•´ì£¼ëŠ” í•¨ìˆ˜
    //   'click' : ë²„íŠ¼ì„ ë§ˆìš°ìŠ¤ë¡œ í´ë¦­í–ˆì„ ë•Œ ì‹¤í–‰í•˜ë¼ëŠ” ëœ»ì„
    //   moveLeft : í´ë¦­í•˜ë©´ moveLeftí•¨ìˆ˜ë¥¼ í˜¸ì¶œí•¨
    document.getElementById('leftBtn').addEventListener('click', moveLeft);
    document.getElementById('rightBtn').addEventListener('click', moveRight);
    document.getElementById('upBtn').addEventListener('click', moveUp);
    document.getElementById('downBtn').addEventListener('click', moveDown);
 </script>

</body>
</html>
