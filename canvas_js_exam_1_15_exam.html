<!DOCTYPE html>
<html lang="en">  <!-- ê¸°ë³¸ì–¸ì–´ : ì˜ì–´ -->
<head>
  <meta charset="UTF-8" /> <!-- í˜ì´ì§€ ì–¸ì–´ ì¸ì½”ë”© í˜•ì‹ -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/> <!-- í™”ë©´í¬ê¸°ì— ë”°ë¼ ë³´ì—¬ì§€ëŠ” í¬ê¸° ë§ì¶”ê¸° -->
  <title>Web Animation(canvas_js_css)[1ë‹¨ì›-11]</title>
  <style>
    /* í˜ì´ì§€ ì „ì²´ ì„¤ì • */
    body {
      margin: 0;
      padding: 0;
      text-align: center;
      font-family: sans-serif;
    }
    /* ì• ë‹ˆë©”ì´ì…˜ í™”ë©´ ì„¤ì • */
    #canvas {
      background: #DCD7C9;
      display: block;
      margin: 0 auto;
    }

    .sound-toggle-wrap{
      position: sticky;
      top: 0;
      z-index: 50;
      display: flex;
      justify-content: center;
      background: rgba(255, 255, 255, 0.9);
      border-bottom: 1px solid #e5e5e5;
      padding: 6px 8px;
    }

    .sound-toggle{
      display: inline-flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      color: #222;
      user-select: none;
    }

    .switch{
      position: relative;
      display: inline-block;
      width: 54px;
      height: 28px;
    }
    .switch input{
      display: none;
    }
    .slider{
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .2s;
      border-radius: 28px;
    }
    .slider::before{
      position: absolute;
      content: "";
      height: 22px;
      width: 22px;
      left: 3px;
      top: 3px;
      background: white;
      transition: .2s;
      border-radius: 50%;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }
    input:checked + .slider{
      background-color: #4CAF50;
    }
    input:checked + .slider::before{
      transform: translateX(26px);
    }

    /* 1_5 : PC ì•ˆë‚´ ë¬¸êµ¬ ê¸°ë³¸ì€ ìˆ¨ê¹€ */
    .pc-guide {
      display: none; /* 1_5 : í™”ë©´ì— ë³´ì´ì§€ ì•Šê²Œí•¨ */
      margin-top: 10px; /* 1_5 : ìœ„ìª½ì—¬ë°± */
      font-size: 16px; /* 1_5 : ë²„íŠ¼ ê¸€ìí¬ê¸° */
      color: #333; /* 1_5 : ê¸€ììƒ‰ */
      font-weight: bold; /* 1_5 : ê¸€ìêµµê²Œ */
    }

    /* PCì—ì„œëŠ” 600x600 ê³ ì • */
    @media (min-width: 769px) {
      #canvas {
      width: 600px;
      height: 600px;
      }

      .pc-guide {
        display: block; /* 1_5 : pc-guideë¥¼ PCì—ì„œ ì ‘ì†ì‹œ ë³´ì´ê²Œí•¨ */
      }
    }

    /* 1_5 : ë²„íŠ¼ì„ ê°ì‹¸ëŠ” div ìˆ¨ê¸°ê¸° (PCì—ì„œëŠ” ì•ˆ ë³´ì´ê²Œí•˜ê³  ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ì ‘ì†ì´ ë³´ì„) */
    .controls {
      display: none; /* 1_5 : í™”ë©´ì— ë³´ì´ì§€ ì•Šê²Œí•¨ */
      margin-top: 10px;
      flex-direction: column;
      align-items: center;
    }

    .controls .row {
      display: flex;
      justify-content: center;
    }

    /* 1_5 : ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ë³´ì—¬ì§ˆ ë²„íŠ¼ ëª¨ì–‘ ì„¤ì • */
    .controls button {
      font-size: 24px;
      padding: 15px 20px;
      margin: 5px;
      min-width: 60px;
      border-radius: 10px;
      border: none;
      background-color: #333;
      color: white;
      touch-action: none;
      user-select: none;
      -webkit-user-select: none;
    }

    .controls button:active {
      background-color: #555;
    }

    /* 1_5 : í™”ë©´ì´ ì‘ì„ ë•Œ (ìŠ¤ë§ˆíŠ¸í° ë“±ì—ì„œ ë³´ì¸ë‹¤ë©´ ì•„ë˜ ì½”ë“œë™ì‘)
       í™”ë©´ì˜ í­ì´ ìµœëŒ€ 768í”½ì…€ë³´ë‹¤ ì´í•˜ì´ë©´ ì•„ë˜ cssë™ì‘í•¨ ì•„ë‹ˆë©´ ìœ„ PCìš© CSS @media (min-width: 769px) ë™ì‘í•¨
       ìµœê·¼ ìŠ¤ë§ˆíŠ¸í°ì˜ í•´ìƒë„ëŠ” PCë³´ë‹¤ë„ ì¢‹ì€ ê²½ìš°ê°€ ë§ì€ë° 768í”½ì…€ë³´ë‹¤ ì‘ìœ¼ë©´ ìŠ¤ë§ˆíŠ¸í°ì´ë¼ë‹ˆ?
        ì´ìœ  : ìŠ¤ë§ˆíŠ¸í°ì˜ ë¬¼ë¦¬ì ì¸ í•´ìƒë„ëŠ” ë” í¬ì§€ë§Œ, í™”ë©´ì„ ì‘ê²Œ ë³´ì´ë„ë¡ í•˜ê¸° ìœ„í•´ **ë””ë°”ì´ìŠ¤ í”½ì…€ ë¹„ìœ¨(DPR, divicePixelRatio)**ì„ ì‚¬ìš©í•¨
       ì•„ì´í°13ì˜ ê°€ë¡œí•´ìƒë„ê°€ 1170í”½ì…€ì¸ë° CSSí”½ì…€ë¡œëŠ” 1170/3=390í”½ì…€ì„
       í˜„ì¬ ê¸°ê¸°ë¡œ ë³´ì•„ë„ 768 CSSí”½ì…€ì´ë©´ ëª¨ë“  ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ì ‘ì†í•˜ëŠ” ê²ƒìœ¼ë¡œ íŒë‹¨í•¨ */

    

    @media (max-width: 768px) {
      #canvas {
        width: 100vw; /* 1_5 : ìŠ¤ë§ˆíŠ¸í° í™”ë©´ canvas ê°€ë¡œ ì „ì²´ í¬ê¸°ë¡œí•¨ */
        height: 100vw; /* 1_5 : í™”ë©´ canvas ì„¸ë¡œ = ê°€ë¡œ (ì •ì‚¬ê°í˜•) */
      }
      .controls {
        display: block; /* 1_5 : ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ì ‘ì†ì‹œ controlsì„ ë³´ì´ê²Œí•¨ */
      }
      .pc-guide {
        display: none; /* 1_5 : pc-guideë¥¼ ìŠ¤ë§ˆíŠ¸í° ì ‘ì†ì‹œ ìˆ¨ê¹€ */
      }
    }

    .game-title {
      text-align: center;
      font-size: 36px;
      font-weight: 900;
      color: #1d3ea3;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      margin-top: 16px;
      margin-bottom: 8px;
      letter-spacing: 2px;
      font-family: 'Trebuchet MS', 'Noto sans KR', sans-serif;
    }

    /* === OverLay_UI === */

    .startoverlay{
      position: fixed;
      inset: 0;
      display: flex;
      
      align-items: center;
      justify-content: center;

      background: transparent;     /* ë°°ê²½ ì•ˆ ì“°ë©´ íˆ¬ëª… */
      pointer-events: none;        /* ì¤‘ìš”: ë’¤ë¥¼ í´ë¦­ ê°€ëŠ¥ */
      z-index: 1000;
    }

    .startoverlay-content {
      width: min(520px, 92vw);
      padding: 60px 32px;
      border-radius: 16px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.35);
      background: white;
      display: flex;
      flex-direction: column;
      gap: 20px;
      pointer-events: auto;
    }

    #startoverlayMessage{
      font-size: 20px;
      margin: 0 0 8px 0;
      opacity: 0.9;
    }

    .startoverlay-content button {
      cursor: pointer;
      user-select: none;
      transition: transform 0.1s ease;
    }

    .startoverlay-content button:hover {
      transform: scale(1.05);
    }

    .startoverlay-content button:active {
      transform: scale(0.95);
    }

    .startBtn{
      background: #34a049;
      color: #fff;
      font-size: 24px;
      font-weight: 800;
      padding: 12px 20px;
      border-radius: 10px;
      border: none;
      box-shadow: 0 6px 14px rgba(0,0,0,0.30);
    }

    .rankpageBtn{
      background: #2b6cb0;
      color: #fff;
      font-size: 20px;
      font-weight: 800;
      padding: 12px 20px;
      border-radius: 10px;
      border: none;
      box-shadow: 0 6px 14px rgba(0,0,0,0.28);
    }


    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 1100;
    }

    .overlay-content {
      background: white;
      padding: 30px;
      border-radius: 10px;
      text-align: center;
      min-width: 250px;
    }

    .overlay-content h2 { margin-bottom: 20px;}
    .overlay-content button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }

    #overlayMessage {
      white-space: pre-line;
    }

  </style>
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyCPSD0RdcqYVHSqnQPdobqD4A4vow5ft4Q",
      authDomain: "my-webgame-project1-92d16.firebaseapp.com",
      projectId: "my-webgame-project1-92d16",
      storageBucket: "my-webgame-project1-92d16.firebasestorage.app",
      messagingSenderId: "349232304034",
      appId: "1:349232304034:web:2cb1bc2aa2736ed0f9acfb",
      measurementId: "G-83HH3SD6JZ"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window._db = db;
  </script>
</head>
<body>
  
  <div class="sound-toggle-wrap">
    <div class="sound-toggle">
      <span id="soundStateEmoji">ğŸ”Š</span>
      <label class="switch" title="ì‚¬ìš´ë“œ On/Off">
        <input type="checkbox" id="soundToggle" checked />
        <span class="slider"></span>
      </label>
      <span id="soundStateText">ON</span>
    </div>
  </div>

  <div class="game-title">ğŸ ìŠ¤í€˜ì–´ íƒ€ì„ëŸ° â±</div>

  <!-- ì• ë‹ˆë©”ì´ì…˜ í™”ë©´ ë§Œë“¤ê¸° -->
  <canvas id="canvas"></canvas>

  <!-- 1_5 : ì• ë‹ˆë©”ì´ì…˜ í™”ë©´ ë§Œë“¤ê¸° : ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ì ‘ì† í•  ë•Œë§Œ controlsì´ ë³´ì´ê²Œë¨ -->
  <div class="controls">
    <div class="row">
      <button id="upBtn">â†‘</button>
    </div>
    <div class="row">
      <button id="leftBtn">â†</button>
      <button id="downBtn">â†“</button>
      <button id="rightBtn">â†’</button>
    </div>
  </div>

  <!-- 1_5 : PC ì „ìš© ì•ˆë‚´ ë¬¸êµ¬ -->
  <div class="pc-guide">
    PCì—ì„œ ì ‘ì†í–ˆìŠµë‹ˆë‹¤. ë°©í–¥í‚¤ë¡œ ì´ë™í•˜ì„¸ìš”.<br>
    ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ì ‘ì† ì‹œ ë³´ì´ëŠ” ë²„íŠ¼ìœ¼ë¡œ ì´ë™í•˜ì„¸ìš”.
  </div>

  <!-- OverLay_UI -->
  <div class="startoverlay" id="startoverlay">
    <div class="startoverlay-content">
      <p id="startoverlayMessage"></p>
      <button class="startBtn" id="startBtn">ê²Œì„ ì‹œì‘!</button>
      <button class="rankpageBtn" id="rankpageBtn">ë­í‚¹ ë³´ê¸°</button>
      <button class="characterBtn" id="characterBtn">ìºë¦­í„°</button>
    </div>
  </div>

  <div class="overlay" id="overlay">
    <div class="overlay-content">
      <h2 id="overlayTitle">Game Over</h2>
      <p id="overlayMessage"></p>
      <input type="text" id="userId" placeholder="(ì˜ì–´+ìˆ«ì) 5~15ìì´ë‚´">
      <br>
      <button id="saveBtn">ì €ì¥</button>
      <button id="cancelBtn">ì·¨ì†Œ</button>
    </div>
  </div>

  <script type="module">
    import {containsSwearWord} from "https://cdn.jsdelivr.net/gh/bc-develop2000/swear_words@main/swear_words.js";
    window.containsSwearWord = containsSwearWord;
    console.log("[swear] module loaded, sample:", containsSwearWord("fuck", "eng"));
  </script>

  <script>
    // ìº”ë²„ìŠ¤ ìš”ì†Œ J5 ë³€ìˆ˜ë§Œë“¤ê¸°
    const drawingBoard = document.getElementById('canvas');
    // ìº”ë²„ìŠ¤ì— 2Dê·¸ë¦¼ì„ ê·¸ë¦¬ëŠ” ë„êµ¬ ë³€ìˆ˜ë§Œë“¤ê¸°
    const drawingPen = drawingBoard.getContext('2d');

    // ìº”ë²„ìŠ¤ í¬ê¸°ë¥¼ CSSì™€ ë§ì¶°ì¤Œ (ì¤‘ìš”!)
    // ì•„ë˜ì²˜ëŸ¼ í•˜ë©´ PCëŠ” 600x600ìœ¼ë¡œ ì„¤ì •ë˜ê³  ìŠ¤ë§ˆíŠ¸í°ì€ 360x360ìœ¼ë¡œ í™”ë©´ê³„ì‚°ëœ ë‚˜ì¤‘ì— í•„ìš”í•˜ë©´ ì°¸ê³ ì‚¬ìš©
    // drawingBoard.width = drawingBoard.clientWidth;
    // drawingBoard.height = drawingBoard.clientHeight;
    // ìº”ë²„ìŠ¤ ë‚´ë¶€ í•´ìƒë„ëŠ” ë¬´ì¡°ê±´ 600x600 ê³ ì •(PC, ìŠ¤ë§ˆíŠ¸í° ëª¨ë‘)
    drawingBoard.width = 600;
    drawingBoard.height = 600;

    // ì£¼ì¸ê³µ ìœ„ì¹˜(í™”ë©´ ì™¼ìª½ í•˜ë‹¨)
    let heroX = 20;
    let heroY = (drawingBoard.height - 30); //570

    //ì  ìœ„ì¹˜(í•˜ë©´ ê°€ìš´ë°)
    let enemyX = new Array(15);
    let enemyY = new Array(15);

    let enemyCnt=(enemyX.length-5);

    

    let timerMinutes = 0;
    let timerSeconds = 0;
    let timerCenti = 0; //  1/100ì´ˆ
    let startTime = Date.now();
    let stopCountdown = null;
    let drawLoopId = null;
    let isGameOver = false;

    let elapsed = 0;

   function startCountdown(ms, onTick, onEnd) {
    const start=performance.now();
    const end=start+ms;
    let tId=0;

    function step() {
      const now = performance.now();
      const remaining = Math.max(0, end - now); //reaminingì— 0ê³¼ end-nowì¤‘ í° ê°’ì„ ë„£ëŠ”ë‹¤.(ìŒìˆ˜ê°€ ë³€ìˆ˜ì— ë“¤ì–´ê°€ëŠ” ê²½ìš°ë¥¼ ì—†ì—ì„œ ë³´ì •ì„ í•¨)
      
      const totalCenti = Math.floor(remaining / 10); // 1/100ì´ˆ ë‹¨ìœ„
      const minutes = Math.floor(totalCenti / 6000); // 60*100
      const seconds = Math.floor((totalCenti % 6000) / 100);
      const centi = totalCenti % 100;

      onTick?.(minutes, seconds, centi);

      if (remaining <= 0) {
        onEnd?.();
        return;
      }
      tId = setTimeout(step, 10);
    }

    step();
    return () => clearInterval(tId);
   }

    //ì£¼ì¸ê³µ í¬ê¸°
    const heroWidth = 10;
    const heroHeith = 10;

    //ì  í¬ê¸°
    const enemyWidth = 20;
    const enemyHeight = 20;

    // ì£¼ì¸ê³µ ì´ë™ì†ë„
    const moveAmount = 5;

    // ì£¼ì¸ê³µ ì´ë™í•¨ìˆ˜
    function moveRight() {heroX = heroX + moveAmount;}
    function moveLeft() {heroX = heroX - moveAmount;}
    function moveDown() {heroY = heroY + moveAmount;}
    function moveUp() {heroY = heroY - moveAmount;}


    // 1_4 : ì£¼ì¸ê³µ ì´ë™ì œí•œ
    function move_limit() {
      if(heroX<0) {//ì™¼ìª½ ì´ë™ì œí•œ
        heroX = 0;
      }
      if(heroX>=drawingBoard.width-10) {//ì˜¤ë¥¸ìª½ ì´ë™ì œí•œ
        heroX = (drawingBoard.width-10);
      }
      if(heroY<0) {//ìœ„ìª½ ì´ë™ì œí•œ
        heroY=0;
      }
      if(heroY>=drawingBoard.height-10) {//ì•„ë˜ìª½ ì´ë™ì œí•œ
        heroY=(drawingBoard.height-10);
      }
    }

    let soundEnabled = true;
    const soundToggle = document.getElementById('soundToggle');
    const soundStateEmoji = document.getElementById('soundStateEmoji');
    const soundStateText = document.getElementById('soundStateText');

    const bgm = new Audio('back_snd1.mp3');
    bgm.loop = true;
    bgm.preload = 'auto';

    const hitSound = new Audio('effect_snd1.mp3');
    hitSound.preload = 'auto';

    const endSound = new Audio('back_snd2.mp3');
    endSound.preload = 'auto';

    function applySoundState() {
      bgm.muted = hitSound.muted = endSound.muted = !soundEnabled;
      soundStateEmoji.textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”ˆ';
      soundStateText.textContent = soundEnabled ? 'ON' : 'OFF';
      if(!soundEnabled){ bgm.pause(); }
      else if( !isGameOver && stopCountdown !== null ){
        try{ bgm.play(); }catch(e){}
      }
    }

    soundToggle.addEventListener('change', ()=>{
      soundEnabled = soundToggle.checked;
      applySoundState();
    });
    applySoundState();

    function safePlay(Audio){
      if(!soundEnabled) return;
      try{Audio.currentTime = 0; Audio.play();}catch(e){}
    }
    function stopAllsfx(){
      [hitSound, endSound].forEach(a=>{a.pause(); a.currentTime = 0;});
    }

    //1_4 : ìº”ë²„ìŠ¤ ì™¼ìª½ ìƒë‹¨ì— í…ìŠ¤íŠ¸ ì¶œë ¥í•¨ìˆ˜
    function drawCoordinate() {
      drawingPen.fillStyle = 'black';
      drawingPen.font = '10px sans-serf';
      drawingPen.fillText(`X: ${heroX} Y: ${heroY}`, 10, 20);
    }

    // ì£¼ì¸ê³µ ì¶œë ¥í•¨ìˆ˜
    function drawHero() {
      drawingPen.fillStyle = 'black';
      drawingPen.fillRect(heroX, heroY, heroWidth, heroHeith);
    }

    // ì¤‘ë³µí™•ì¸ í•¨ìˆ˜
    // ë§ì´ ì“°ì´ëŠ” í‘œì¤€í˜•: ì¢Œí‘œë¥¼ ëœë¤ ìƒì„± í›„ ì¤‘ë³µì‹œ ë‹¤ì‹œ ì‹œë„
    function non_overlapArrayFill() {
      const maxAttempts = 500;

      for (let i = 0; i < enemyX.length; i++) {
        let attempts = 0;
        let valid = false;

        while (!valid && attempts < maxAttempts) {
          const tempX = Math.floor(Math.random() * (drawingBoard.width - enemyWidth));
          const tempY = Math.floor(Math.random() * ((drawingBoard.height - enemyHeight) - 15 + 1))+15;
          valid = true;

          for (let j = 0; j < i; j++) {
            if (collisionCheck(tempX, tempY, enemyWidth + 5, enemyHeight + 5,
                enemyX[j], enemyY[j], enemyWidth + 5, enemyHeight + 5)) {
              valid = false;
              break;
            }
          }

          if (valid) {
            enemyX[i] = tempX;
            enemyY[i] = tempY;
          }

          attempts++;
        }

        if (attempts >= maxAttempts) {
          console.warn(`ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ê²Œì„ì„ ì¬ì‹œì‘í•©ë‹ˆë‹¤.`);
          location.reload();
        }
      }
    }

    // ì  ì¶œë ¥í•¨ìˆ˜
    function enemy1() {
      for (let i = 0; i < (enemyX.length-5); i++) {
        drawingPen.fillStyle = 'red';
        drawingPen.fillRect(enemyX[i], enemyY[i], enemyWidth, enemyHeight);
      }
    }

    function enemy2() {
      for (let i = 10; i <= enemyX.length; i++) {
        drawingPen.fillStyle = 'blue';
        drawingPen.fillRect(enemyX[i], enemyY[i], enemyWidth, enemyHeight);
      }
    }

    // ì¶©ëŒ ê°ì§€ í•¨ìˆ˜
    function collisionCheck(aX, aY, aWidth, aHeith, bX, bY, bWidth, bHeith) {
      if(((aX+aWidth) > bX && aX < (bX+bWidth)) && ((aY+aHeith) > bY && aY < (bY+bHeith))) {
        return true;
      }else{
        return false;
      }
    }

    //  ì  ì¶©ëŒ í•¨ìˆ˜
    function collision1() {
      for (let i = 0; i < (enemyX.length-5); i++) {
        if(collisionCheck(heroX, heroY, heroWidth, heroWidth, enemyX[i], enemyY[i], enemyWidth, enemyHeight)) {
          enemyX[i] = Number.MAX_SAFE_INTEGER
          enemyY[i] = Number.MAX_SAFE_INTEGER
          enemyCnt--;
        }
      }
    }

    function collision2() {
      for (let i = 10; i <= enemyX.length; i++) {
        if(collisionCheck(heroX, heroY, heroWidth, heroWidth, enemyX[i], enemyY[i], enemyWidth, enemyHeight)) {
          isGameOver = true;
          stopAllsfx();
          if(soundEnabled){
            hitSound.onended = () => {
              endSound.onended = null;
              bgm.pause();
              safePlay(endSound);
              gameOverOverlay("over");
            };  
          }
          safePlay(hitSound);
          setTimeout(()=>{
            gameOverOverlay("over");
          }, 600);
        }
      }
    }

    function counter() {
        drawingPen.fillStyle = 'black';
        drawingPen.font = '10px sans-serf';
        drawingPen.fillText(`RED no ${enemyCnt}`, 550, 20);
    }

    function drawTimer() {
      drawingPen.fillStyle = 'black';
      drawingPen.font = '20px sans-serf';
      drawingPen.fillText(`${timerMinutes}:${timerSeconds.toString().padStart(2,"0")}:${timerCenti.toString().padStart(2,"0")}`,
        (canvas.width/2)-40, 20
      );
    }

    const keys = {
      ArrowLeft: false,
      ArrowRight: false,
      ArrowUp: false,
      ArrowDown: false
    }

    document.addEventListener('keydown', (e) => {
      if (keys.hasOwnProperty(e.key)) {
        keys[e.key] = true;
      }
    });

    document.addEventListener('keyup', (e) => {
      if(keys.hasOwnProperty(e.key)) {
        keys[e.key] = false;
      }
    });

    // === OverLay ê´€ë ¨ ===
    const overlay = document.getElementById("overlay");
    const overlayTitle = document.getElementById("overlayTitle");
    const overlayMessage = document.getElementById("overlayMessage");
    const userIdInput = document.getElementById("userId");
    const saveBtn = document.getElementById("saveBtn");
    const cancelBtn = document.getElementById("cancelBtn");
    

    function gameOverOverlay(type, value = "") {
      if (type === "over") {
        overlayTitle.textContent = "ê²Œì„ì˜¤ë²„";
        overlayMessage.textContent = "ì‹œê°„ì´ ë‹¤ ë˜ì—ˆìŠµë‹ˆë‹¤!";
      }else if (type === "record") {
        overlayTitle.textContent = "ğŸ‰ í´ë¦¬ì–´!";
        overlayMessage.textContent = `ê¸°ë¡: ${value}ì´ˆ\nì €ì¥ ì•„ì´ë””((ì˜ì–´+ìˆ«ì) 5~15ìì´ë‚´)ë¥¼ ì…ë ¥í•˜ì„¸ìš”.`;
      }
      overlay.style.display = "flex";
    }

    function resetGame() {
      isGameOver != isGameOver;

    }

    saveBtn.addEventListener("click", async () => {
      const val = userIdInput.value.trim();
      if (typeof window.containsSwearWord !== `function`) {
        alert(`ìš•ì„¤ í•„í„° ëª¨ë“ˆì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (ESM import í™•ì¸)`);
        console.error(`[swear] containsSwearWord no ready`);
        return;
      }
      const re = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z0-9]{5,15}$/;

      if (containsSwearWord(val, "eng")) {
        alert("ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ë‹¨ì–´ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.");
        userIdInput.focus();
        return;
      }
      if(!re.test(val)) {
        alert("ì•„ì´ë””ëŠ” ì˜ì–´ì™€ ìˆ«ìë¥¼ ë°˜ë“œì‹œ í¬í•¨í•œ 5~15ìì—¬ì•¼ í•©ë‹ˆë‹¤.");
        userIdInput.focus();
        return;
      }
      alert(`ì…ë ¥í•œ ì•„ì´ë””ëŠ” ${val}ì…ë‹ˆë‹¤.`);

      try {
        const db = window._db;

        if(!db) {
          alert("DB ì´ˆê¸°í™” ì‹¤íŒ¨: Firebase ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.");
          return;
        }

        const {collection, addDoc, serverTimestamp} = await import(
          "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js"
        );

        await addDoc(collection(db, "scores_exam"), {
          userId: val,
          time: elapsed,
          createAt: serverTimestamp()
        });

        alert(`ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nID: ${val}\nê¸°ë¡: ${elapsed}ì´ˆ`);
        location.href="canvas_js_exam_1_13_exam_rankpage.html"
        // alert("ì €ì¥ ì„±ê³µ : ë‹¤ìŒ ë‹¨ì›ì—ì„œëŠ” ì„±ê³µì‹œ rankpage.html í˜ì´ì§€ë¡œ ì´ë™ì„ í•™ìŠµí•©ë‹ˆë‹¤.");
      } catch(err) {
        console.error(err);
        alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.");
      }
      // location.reload();
    });

    cancelBtn.addEventListener("click", () => {
     bgm.pause();
     stopAllsfx();
     drawingPen.clearRect(0, 0, canvas.width, canvas.height);
     overlay.style.display = 'none';
     gameStartOverlay();
    });

    const startoverlay = document.getElementById("startoverlay");
    const startoverlayTitle = document.getElementById("startoverlayTitle");
    const startoverlayMessage = document.getElementById("startoverlayMessage");
    const startBtn = document.getElementById("startBtn");
    const rankpageBtn = document.getElementById("rankpageBtn");
    const characterBtn = document.getElementById("characterBtn");
    

    function gameStartOverlay() {
        startoverlayMessage.textContent = "íŒŒë€ìƒ‰ ì ì„ í”¼í•´ ë¹¨ê°„ìƒ‰ ì ì„ ëª¨ë‘ ì¡ìœ¼ì„¸ìš”!";
        startoverlay.style.display = "flex";

        startBtn.addEventListener("click", () => {
          startoverlay.style.display = "none";

          isGameOver = false;
          enemyCnt = enemyX.length - 5;
          startTime = Date.now();

          if(soundEnabled){
            try{bgm.currentTime = 0; bgm.play();}catch(e){}
          }

          non_overlapArrayFill();

          if (drawLoopId) clearInterval(drawLoopId);
          drawLoopId = setInterval(draw, 16);

          if (stopCountdown) stopCountdown();
          stopCountdown = startCountdown(
            60_000,
            (m, s, c) => { timerMinutes = m; timerSeconds = s; timerCenti = c; },
            () => {
              if (!isGameOver) {              // ì´ë¯¸ ê²Œì„ ëë‚¬ìœ¼ë©´ ë‹¤ì‹œ ì•ˆ ë„ì›€
                isGameOver = true;
                gameOverOverlay("over");
              }
            }
          );
        }, {once: true});

        characterBtn.addEventListener("click", () => alert());
        rankpageBtn.addEventListener("click", () => { location.href="canvas_js_exam_1_13_exam_rankpage.html" });
      }

    // í™”ë©´ì— ì¶œë ¥í•˜ê¸°
    function draw() {
      if (isGameOver) return; // ê²Œì„ ëë‚¬ìœ¼ë©´ draw ë£¨í”„ ì¤‘ë‹¨

      drawingPen.fillText(`X: ${heroX} Y: ${heroY}`, 10, 20); //1_4 : ìº”ë²„ìŠ¤ ì™¼ìª½ ìƒë‹¨ì— í…ìŠ¤íŠ¸ ì¶œë ¥
      drawingPen.clearRect(0, 0, canvas.width, canvas.height);  //í™”ë©´ì§€ìš°ê¸°/      drawTimer();  // íƒ€ì´ë¨¸ì¶œë ¥í•¨ìˆ˜í˜¸ì¶œ
      drawHero(); // ì£¼ì¸ê³µì¶œë ¥í•¨ìˆ˜í˜¸ì¶œ
      enemy1(); // ì  ì¶œë ¥í•¨ìˆ˜ í˜¸ì¶œ
      enemy2();
      collision1(); //ì  ì¶©ëŒí•¨ìˆ˜ í˜¸ì¶œ
      collision2();
      counter();  // ì  ì¹´ìš´íŠ¸í•¨ìˆ˜ í˜¸ì¶œ
      move_limit(); //1_4 : ì£¼ì¸ê³µ ì´ë™ ì œí•œ í•¨ìˆ˜í˜¸ì¶œ
      drawCoordinate(); //1_4 : í…ìŠ¤íŠ¸ ì¶œë ¥ í•¨ìˆ˜í˜¸ì¶œ
      drawTimer();  //íƒ€ì´ë¨¸ ì¶œë ¥í•¨ìˆ˜ í˜¸ì¶œ

      if (keys.ArrowLeft) moveLeft();
      if (keys.ArrowRight) moveRight();
      if (keys.ArrowUp) moveUp();
      if (keys.ArrowDown) moveDown();

      // ì¡°ê±´ ì²´í¬
      if (enemyCnt === 0 && !isGameOver) {
        elapsed = ((Date.now() - startTime)/1000).toFixed(2);
        stopCountdown?.();
        isGameOver = true;
        gameOverOverlay("record", elapsed);
      }
    }

    gameStartOverlay();
    
    const setBtnHod = (key, isDown) => {
      keys[key] = isDown;
    };

    const bindButton = (id, key) => {
      const btn = document.getElementById(id);
      btn.addEventListener('touchstart', () => setBtnHod(key, true));
      btn.addEventListener('touchend', () => setBtnHod(key, false));
      btn.addEventListener('mousedown', () => setBtnHod(key, true));
      btn.addEventListener('mouseup', () => setBtnHod(key, false));
      btn.addEventListener('mouseleave', () => setBtnHod(key, false));
    };

    bindButton("leftBtn", "ArrowLeft");
    bindButton("rightBtn", "ArrowRight");
    bindButton("upBtn", "ArrowUp");
    bindButton("downBtn", "ArrowDown");
 </script>

</body>
</html>
